(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[80],{"327f":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",{staticClass:"flex column"},[r("div",{staticClass:"row bg-primary text-accent"},[e.$route.fullPath.includes("/view-chat")?r("q-btn",{directives:[{name:"go-back",rawName:"v-go-back.single",modifiers:{single:!0}}],attrs:{icon:"arrow_back",flat:"",dense:""}}):e._e(),r("q-space"),r("div",{staticClass:"text-center"},[r("p",{staticClass:"text-h6 q-pa-sm"},[e._v(e._s(e.toUser.fullName))])])],1),r("div",{staticClass:"row"},[r("div",{staticClass:"q-pa-sm col-12 text-center"},[r("q-select",{attrs:{color:"accent",outlined:"","label-color":"accent",options:e.categories,label:"Category"},on:{input:e.onItemValueChanged},model:{value:e.selectedCategory,callback:function(t){e.selectedCategory=t},expression:"selectedCategory"}})],1)]),r("div",{staticClass:"q-pa-sm"},[e.typing?r("small",[e._v(e._s(e.toUser.fullName)+" is typing...")]):e._e()]),r("q-separator"),r("div",{staticClass:"q-pa-md column col justify-end"},e._l(e.messages,(function(t){return r("q-chat-message",{key:t.time,attrs:{name:t.fromFullName,text:[t.message],sent:t.fromId==""+e.fromUser.categoryId}})})),1),r("q-footer",[r("q-toolbar",{staticClass:"bg-accent"},[r("q-input",{ref:"chatbox",staticClass:"full-width",attrs:{"bg-color":"primary",outlined:"",rounded:"",label:"Message",dense:""},scopedSlots:e._u([{key:"after",fn:function(){return[r("q-btn",{attrs:{round:"",dense:"",flat:"",color:"primary",icon:"send"},on:{click:e.send}})]},proxy:!0}]),model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}})],1)],1)],1)},a=[],o=r("9289"),n=r.n(o),c=r("549c"),l=r.n(c),i=r("52b5"),u=r.n(i),m=(r("c889"),r("ef92"),r("0012"),r("f69e"),r("ad58"),r("d93a"),r("b491")),g=r("0601");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){n()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p={data:function(){return{toUser:{},fromUser:{fromId:""},meetingId:"123",socket:null,serverUrl:"https://school-mgt-backend-nestjs.herokuapp.com/",newMessage:null,messages:[],typing:!1,username:null,ready:!1,info:[],connections:0,deviceId:"",categories:["CategoryN500","CategoryN1000","CategoryN2000","CategoryN5000","CategoryN10000"],selectedCategory:"CategoryN500"}},watch:{newMessage:function(e){var t=this;e?t.socket.emit("typing",t.fromUser.username):t.socket.emit("stopTyping")}},methods:{send:function(){var e=this,t={appName:"LAUNCHPAD",time:Date.now(),fromId:e.fromUser.categoryId,toId:e.toUser.categoryId,fromUserName:e.fromUser.username,toUserName:e.toUser.username,fromFullName:e.fromUser.fullName,toFullName:e.toUser.fullName,message:e.newMessage,meetingId:e.meetingId,images:[],messageStatus:"unread",selectedCategory:e.selectedCategory};e.messages.push(t),console.log("socket.emit: ",t),e.socket.emit("chat-message",t),e.newMessage=null},connectToWebsocket:function(){var e=this;e.socket=Object(m["a"])(e.serverUrl,{transports:["websocket"]})},loadMessages:function(){var e=this;return l()(u.a.mark((function t(){var r,s,a;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e,r.messages=[],t.t0=r.selectedCategory,t.next="CategoryN500"===t.t0?5:"CategoryN1000"===t.t0?7:"CategoryN2000"===t.t0?9:"CategoryN5000"===t.t0?11:"CategoryN10000"===t.t0?13:15;break;case 5:return r.fromUser=e.$store.getters["authenticationStore/categoryN500User"],t.abrupt("break",15);case 7:return r.fromUser=e.$store.getters["authenticationStore/categoryN1000User"],t.abrupt("break",15);case 9:return r.fromUser=e.$store.getters["authenticationStore/categoryN2000User"],t.abrupt("break",15);case 11:return r.fromUser=e.$store.getters["authenticationStore/categoryN5000User"],t.abrupt("break",15);case 13:return r.fromUser=e.$store.getters["authenticationStore/categoryN10000User"],t.abrupt("break",15);case 15:return console.log("context.fromUser: ",r.fromUser),s={url:"launchstory/messagesByOneFriend",req:{fromUser:{id:r.fromUser.categoryId,username:r.fromUser.username,fullName:r.fromUser.fullName},toUser:{id:r.toUser.categoryId,username:r.toUser.username,fullName:r.toUser.fullName},selectedCategory:r.selectedCategory}},t.next=19,Object(g["a"])(s);case 19:a=t.sent,a.data.length>0&&(r.messages=a.data.map((function(e){return f(f({},e),{},{fromUserName:e.fromUser,toUserName:e.toUser})})),console.log("context.messages: ",r.messages));case 21:case"end":return t.stop()}}),t)})))()},onItemValueChanged:function(){var e=this;return l()(u.a.mark((function t(){var r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,t.next=3,r.loadMessages();case 3:case"end":return t.stop()}}),t)})))()}},destroyed:function(){console.log("destroyed")},created:function(){var e=this;return l()(u.a.mark((function t(){var r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,r.toUser=e.$store.getters["authenticationStore/toUser"],console.log("context.toUser: ",r.toUser),r.selectedCategory=e.$store.getters["dashboardStore/selectedCategory"],t.next=6,r.loadMessages();case 6:r.connectToWebsocket(),r.socket.on("chat-message",(function(e){e&&r.toUser.username===e.fromUserName&&r.messages.push({time:e.id,fromId:e.fromId,toId:e.toId,fromUserName:e.fromUserName,toUserName:e.toUserName,fromFullName:e.fromFullName,toFullName:e.toFullName,message:e.message,meetingId:e.meetingId,appName:e.appName,messageStatus:e.messageStatus,selectedCategory:r.selectedCategory})})),r.socket.on("typing",(function(e){r.toUser.username===e&&(r.typing=e)})),r.socket.on("stopTyping",(function(){r.typing=!1})),r.socket.on("connected",(function(e){r.deviceId=e,console.log("context.deviceId: ",r.deviceId)})),e.$refs.chatbox.$el.focus();case 12:case"end":return t.stop()}}),t)})))()}},y=p,b=r("a6c2"),U=r("505d"),h=r("ef9c"),N=r("dc01"),v=r("f636"),C=r("3f5f"),w=r("a3be"),k=r("273c"),I=r("d09b"),x=r("66cf"),O=r("3548"),j=r("406f"),S=r("63c1"),q=r.n(S),M=Object(b["a"])(y,s,a,!1,null,null,null);t["default"]=M.exports;q()(M,"components",{QPage:U["a"],QBtn:h["a"],QSpace:N["a"],QSelect:v["a"],QSeparator:C["a"],QInput:w["a"],QChatMessage:k["a"],QFooter:I["a"],QToolbar:x["a"],QForm:O["a"]}),q()(M,"directives",{GoBack:j["a"]})}}]);